<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.8">
    <title>Xe tăng về thành</title>
    <link href="style.css" rel="stylesheet">
    <link href="baseStyle.css" rel="stylesheet">
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="xetangvethanh.netlify.app"/>
    <meta property="og:title" content="Xe tăng về thành"/>
    <meta property="og:description" content="Thân mời bạn cùng tham gia trò chơi Xe tăng về thành."/>
    <meta property="og:image" content="asset/TriangleBackground.png"/>
</head>
<body>
<div id="titleArea">Xe tăng về thành</div>
<div id="playArea"></div>
<div id="controlArea"></div>
<div id="audioArea">
    <audio id="backgroundSound" src="asset/PureSummer.mp3" preload="auto"></audio>
    <audio id="explosionSound" src="asset/ExplosionSound.mp3" preload="auto"></audio>
    <audio id="victorySound" src="asset/VictorySound.mp3" preload="auto"></audio>
</div>
</body>
</html>

<script>
    let playArea = document.getElementById('playArea');

    let dimension = 5,
        baseDistance = 66,
        minLocation = '2px',
        maxLocation = getLocation(dimension - 1);

    let table = document.createElement('table');
    playArea.appendChild(table);
    for (let i = 0; i < dimension; i++) {
        let tableRow = document.createElement('tr');
        table.appendChild(tableRow);

        for (let i = 0; i < dimension; i++) {
            let tableCell = document.createElement('td');
            tableRow.appendChild(tableCell)
        }
    }

    let tankPosition = [0, 0];
    let tank = document.createElement('div');
    tank.id = 'tank';
    tank.style.top = getLocation(tankPosition[0]);
    tank.style.left = getLocation(tankPosition[1]);
    playArea.appendChild(tank);

    let castlePosition = [dimension - 1, dimension - 1];
    let castle = document.createElement('div');
    castle.id = 'castle';
    castle.style.top = getLocation(castlePosition[0]);
    castle.style.left = getLocation(castlePosition[1]);
    playArea.appendChild(castle);

    let bombArray = [];
    let bombPosition = [[0, 1], [1, 3], [3, 2], [4, 0], [3, 4]];
    let bombAmount = bombPosition.length;

    for (let i = 0; i < bombAmount; i++) {
        let bomb = document.createElement('div');
        bomb.id = 'bomb';
        bomb.style.left = getLocation(bombPosition[i][0]);
        bomb.style.top = getLocation(bombPosition[i][1]);
        playArea.appendChild(bomb);
        bombArray.push(bomb);
    }

    let arrowName = ['ArrowUp', 'ArrowRight', 'ArrowDown', 'ArrowLeft'];
    let controlArea = document.getElementById('controlArea');
    for (let i = 0; i < arrowName.length; i++) {
        let arrow = document.createElement('div');
        arrow.className = arrowName[i].toLowerCase();
        arrow.onclick = function () {
            moveTank(arrowName[i]);
        };
        controlArea.appendChild(arrow);
    }

    let circle = document.createElement('div');
    circle.id = 'circle';
    controlArea.appendChild(circle);

    window.addEventListener("DOMContentLoaded", function () {
        let backgroundSound = document.getElementById('backgroundSound');
        backgroundSound.play();
        backgroundSound.volume = 0.9;
    });
    let explosionSound = document.getElementById('explosionSound');
    explosionSound.playbackRate = 1.2;
    explosionSound.volume = 0.5;
    let victorySound = document.getElementById('victorySound');
    victorySound.volume = 0.5;

    window.onkeydown = function (event) {
        if (arrowName.includes(event.key)) {
            moveTank(event.key);
        } else {
            event.preventDefault();
        }
    }

    function result() {
        for (let i = 0; i < bombAmount; i++) {
            if (String(tankPosition) === String(bombPosition[i])) {
                let explosion = document.createElement('div');
                explosion.id = 'explosion';
                explosion.style.left = getLocation(tankPosition[0]);
                explosion.style.top = getLocation(tankPosition[1]);
                playArea.removeChild(tank);
                playArea.appendChild(explosion);
                explosionSound.play();
            }
        }

        if (String(tankPosition) === String(castlePosition)) {
            let firework = document.createElement('div');
            firework.id = 'firework';
            firework.style.left = getLocation(tankPosition[0]);
            firework.style.top = getLocation(tankPosition[1]);
            playArea.removeChild(tank);
            playArea.removeChild(castle);
            playArea.appendChild(firework);
            victorySound.play();
        }
    }

    function moveTank(key) {
        if (playArea.contains(tank)) {
            let boundary, distance;
            if (key === 'ArrowUp' || key === 'ArrowLeft') {
                boundary = minLocation;
                distance = -baseDistance;
            } else {
                boundary = maxLocation;
                distance = baseDistance;
            }

            if (key === 'ArrowUp' || key === 'ArrowDown') {
                tank.style.top = tank.style.top === boundary
                    ? tank.style.top
                    : parseInt(tank.style.top) + distance + 'px';
            } else {
                tank.style.left = tank.style.left === boundary
                    ? tank.style.left
                    : parseInt(tank.style.left) + distance + 'px';
            }
            tankPosition = [getPosition(tank.style.left), getPosition(tank.style.top)];
            result();

            let control = document.getElementsByClassName(key.toLowerCase())[0];
            control.classList.add('active');
            setTimeout(function () {
                control.classList.remove('active');
            }, 100);
        }
    }

    function getLocation(position) {
        return (parseInt(minLocation) + baseDistance * position) + 'px';
    }

    function getPosition(location) {
        return (parseInt(location) - parseInt(minLocation)) / baseDistance;
    }

    function randomize(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }
</script>