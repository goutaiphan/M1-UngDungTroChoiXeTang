<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Xe tăng về thành</title>
    <link href="style.css" rel="stylesheet">
    <link rel="shortcut icon" href="#"/>
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=0.8">
</head>
<body>
<div id="titleArea">Xe tăng về thành</div>
<div id="playArea"></div>
<div id="controlArea"></div>
</body>
</html>

<script>
    let playArea = document.getElementById('playArea');

    let explosionSound = document.createElement('audio');
    explosionSound.src = 'asset/ExplosionSound.mp3';
    explosionSound.preload;
    explosionSound.playbackRate = 1.1;
    document.body.appendChild(explosionSound);

    let victorySound = document.createElement('audio');
    victorySound.src = 'asset/VictorySound.mp3';
    victorySound.preload;
    document.body.appendChild(victorySound);

    let controlArea = document.getElementById('controlArea');
    let array = ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'];
    for (let i = 0; i < array.length; i++) {
        let arrow = document.createElement('img');
        arrow.className = 'arrow';
        arrow.id = array[i].toLowerCase();
        arrow.src = 'asset/' + array[i] + '.png';
        arrow.onclick = function () {
            move(array[i]);
        };
        controlArea.appendChild(arrow);
    }

    let table = document.createElement('table');
    playArea.appendChild(table);
    let dimension = 5;
    for (let i = 0; i < dimension; i++) {
        let tableRow = document.createElement('tr');
        table.appendChild(tableRow);

        for (let i = 0; i < dimension; i++) {
            let tableCell = document.createElement('td');
            tableRow.appendChild(tableCell)
        }
    }

    let distance = 61;
    let minLocation = '2px';
    let maxLocation = getLocation(dimension - 1);

    let tankPosition = [0, 0];
    let tank = document.createElement('img');
    tank.src = 'asset/tank.png';
    tank.id = 'tank';

    let tankArea = document.createElement('div');
    tankArea.id = 'tankArea';
    tankArea.style.top = getLocation(tankPosition[0]);
    tankArea.style.left = getLocation(tankPosition[1]);
    tankArea.appendChild(tank);
    playArea.appendChild(tankArea);

    let castlePosition = [dimension - 1, dimension - 1];
    let castle = document.createElement('img');
    castle.src = 'asset/castle.png';
    castle.id = 'castle';

    let castleArea = document.createElement('div');
    castleArea.id = 'tankArea';
    castleArea.style.top = getLocation(castlePosition[0]);
    castleArea.style.left = getLocation(castlePosition[1]);
    castleArea.appendChild(castle);
    playArea.appendChild(castleArea);

    let bombArray = [];
    let bombPosition = [[0, 1], [1, 3], [3, 2], [4, 0], [3, 4]];
    let bombAmount = bombPosition.length;

    for (let i = 0; i < bombAmount; i++) {
        let bomb = document.createElement('img');
        bomb.src = 'asset/bomb.png';
        bomb.id = 'bomb';

        let bombArea = document.createElement('div');
        bombArea.id = 'bombArea';
        bombArea.style.left = getLocation(bombPosition[i][0]);
        bombArea.style.top = getLocation(bombPosition[i][1]);
        bombArea.appendChild(bomb);
        playArea.appendChild(bombArea);
        bombArray.push(bombArea);
    }

    window.onkeydown = function (event) {
        array.includes(event.key)
            ? move(event.key)
            : event.preventDefault();
    }

    function result() {
        for (let i = 0; i < bombAmount; i++) {
            if (String(tankPosition) === String(bombPosition[i])) {
                let explosion = document.createElement('img');
                explosion.src = 'asset/explosion.png';
                explosion.id = 'explosion';

                let explosionArea = document.createElement('div');
                explosionArea.id = 'explosionArea';
                explosionArea.style.left = getLocation(tankPosition[0]);
                explosionArea.style.top = getLocation(tankPosition[1]);
                explosionArea.appendChild(explosion);
                playArea.removeChild(tankArea);
                playArea.appendChild(explosionArea);

                explosionSound.play();
                explosionArea.style.opacity = '0';
                let opacity = 0;
                setInterval(function () {
                    opacity += 0.1;
                    explosionArea.style.opacity = opacity;
                }, 80);
            }
        }

        if (String(tankPosition) === String(castlePosition)) {
            let firework = document.createElement('img');
            firework.src = 'asset/firework.png';
            firework.id = 'firework';

            let fireworkArea = document.createElement('div');
            fireworkArea.id = 'fireworkArea';
            fireworkArea.style.left = getLocation(tankPosition[0]);
            fireworkArea.style.top = getLocation(tankPosition[1]);
            fireworkArea.appendChild(firework);
            playArea.removeChild(tankArea);
            playArea.removeChild(castleArea);
            playArea.appendChild(fireworkArea);

            victorySound.play();
            fireworkArea.style.opacity = '0';
            let opacity = 0;
            setInterval(function () {
                opacity += 0.1;
                fireworkArea.style.opacity = opacity;
            }, 100);
        }
    }

    function move(key) {
        if (playArea.contains(tankArea)) {
            let limitLocation, trueDistance;

            if (key === 'ArrowUp' || key === 'ArrowLeft') {
                limitLocation = minLocation;
                trueDistance = -distance;
            } else {
                limitLocation = maxLocation;
                trueDistance = distance;
            }

            if (key === 'ArrowUp' || key === 'ArrowDown') {
                tankArea.style.top = tankArea.style.top === limitLocation
                    ? tankArea.style.top
                    : parseInt(tankArea.style.top) + trueDistance + 'px';
            } else {
                tankArea.style.left = tankArea.style.left === limitLocation
                    ? tankArea.style.left
                    : parseInt(tankArea.style.left) + trueDistance + 'px';
            }

            tankPosition = [getPosition(tankArea.style.left), getPosition(tankArea.style.top)];
            result();
        }
    }

    function getLocation(position) {
        return (parseInt(minLocation) + distance * position) + 'px';
    }

    function getPosition(location) {
        return (parseInt(location) - parseInt(minLocation)) / distance;
    }

    function randomize(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }
</script>