<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.8">
    <title>Xe tăng về thành</title>
    <link href="style.css" rel="stylesheet">
    <link href="baseStyle.css" rel="stylesheet">
    <link href="#" rel="icon"/>
</head>
<body>
<div id="titleArea">Xe tăng về thành</div>
<div id="playArea"></div>
<div id="controlArea"></div>
<div id="audioArea">
    <audio id="explosionSound" src="asset/ExplosionSound.mp3" preload="auto"></audio>
    <audio id="victorySound" src="asset/VictorySound.mp3" preload="auto"></audio>
</div>
</body>
</html>

<script>
    let playArea = document.getElementById('playArea');

    let dimension = 5,
        baseDistance = 61,
        minLocation = '2px',
        maxLocation = getLocation(dimension - 1);

    let table = document.createElement('table');
    playArea.appendChild(table);
    for (let i = 0; i < dimension; i++) {
        let tableRow = document.createElement('tr');
        table.appendChild(tableRow);

        for (let i = 0; i < dimension; i++) {
            let tableCell = document.createElement('td');
            tableRow.appendChild(tableCell)
        }
    }

    let tankPosition = [0, 0];
    let tank = document.createElement('img');
    tank.id = 'tank';
    tank.src = 'asset/tank.png';

    let tankArea = document.createElement('div');
    tankArea.id = 'tankArea';
    tankArea.style.top = getLocation(tankPosition[0]);
    tankArea.style.left = getLocation(tankPosition[1]);
    tankArea.appendChild(tank);
    playArea.appendChild(tankArea);

    let castlePosition = [dimension - 1, dimension - 1];
    let castle = document.createElement('img');
    castle.id = 'castle';
    castle.src = 'asset/castle.png';

    let castleArea = document.createElement('div');
    castleArea.id = 'tankArea';
    castleArea.style.top = getLocation(castlePosition[0]);
    castleArea.style.left = getLocation(castlePosition[1]);
    castleArea.appendChild(castle);
    playArea.appendChild(castleArea);

    let bombArray = [];
    let bombPosition = [[0, 1], [1, 3], [3, 2], [4, 0], [3, 4]];
    let bombAmount = bombPosition.length;

    for (let i = 0; i < bombAmount; i++) {
        let bomb = document.createElement('img');
        bomb.id = 'bomb';
        bomb.src = 'asset/bomb.png';

        let bombArea = document.createElement('div');
        bombArea.id = 'bombArea';
        bombArea.style.left = getLocation(bombPosition[i][0]);
        bombArea.style.top = getLocation(bombPosition[i][1]);
        bombArea.appendChild(bomb);
        playArea.appendChild(bombArea);
        bombArray.push(bombArea);
    }

    let arrowName = ['ArrowUp', 'ArrowRight', 'ArrowDown', 'ArrowLeft'];
    let controlArea = document.getElementById('controlArea');
    for (let i = 0; i < arrowName.length; i++) {
        let arrow = document.createElement('button');
        arrow.className = arrowName[i].toLowerCase();
        if (playArea.contains(tankArea)) {
            arrow.onclick = function () {
                moveTank(arrowName[i]);
            };
        }
        controlArea.appendChild(arrow);
    }

    let explosionSound = document.getElementById('explosionSound');
    explosionSound.playbackRate = 1.1;
    explosionSound.volume = 0.5;
    let victorySound = document.getElementById('victorySound');
    victorySound.volume = 0.5;

    window.onkeydown = function (event) {
        if (arrowName.includes(event.key) && playArea.contains(tankArea)) {
            moveTank(event.key);
            moveControl(event.key);
        } else {
            event.preventDefault();
        }
    }

    function result() {
        for (let i = 0; i < bombAmount; i++) {
            if (String(tankPosition) === String(bombPosition[i])) {
                let explosion = document.createElement('img');
                explosion.id = 'explosion';
                explosion.src = 'asset/explosion.png';

                let explosionArea = document.createElement('div');
                explosionArea.id = 'explosionArea';
                explosionArea.style.left = getLocation(tankPosition[0]);
                explosionArea.style.top = getLocation(tankPosition[1]);
                explosionArea.appendChild(explosion);
                playArea.removeChild(tankArea);
                playArea.appendChild(explosionArea);

                explosionSound.play();
            }
        }

        if (String(tankPosition) === String(castlePosition)) {
            let firework = document.createElement('img');
            firework.id = 'firework';
            firework.src = 'asset/firework.png';

            let fireworkArea = document.createElement('div');
            fireworkArea.id = 'fireworkArea';
            fireworkArea.style.left = getLocation(tankPosition[0]);
            fireworkArea.style.top = getLocation(tankPosition[1]);
            fireworkArea.appendChild(firework);
            playArea.removeChild(tankArea);
            playArea.removeChild(castleArea);
            playArea.appendChild(fireworkArea);

            victorySound.play();
        }
    }

    function moveTank(key) {
        let boundary, distance;

        if (key === 'ArrowUp' || key === 'ArrowLeft') {
            boundary = minLocation;
            distance = -baseDistance;
        } else {
            boundary = maxLocation;
            distance = baseDistance;
        }

        if (key === 'ArrowUp' || key === 'ArrowDown') {
            tankArea.style.top = tankArea.style.top === boundary
                ? tankArea.style.top
                : parseInt(tankArea.style.top) + distance + 'px';
        } else {
            tankArea.style.left = tankArea.style.left === boundary
                ? tankArea.style.left
                : parseInt(tankArea.style.left) + distance + 'px';
        }
        tankPosition = [getPosition(tankArea.style.left), getPosition(tankArea.style.top)];
        result();
    }

    function moveControl(key){
        document.getElementsByClassName(key.toLowerCase())[0].classList.add('active');
        setTimeout(function() {
            document.getElementsByClassName(key.toLowerCase())[0].classList.remove('active');
        }, 100);
    }

    function getLocation(position) {
        return (parseInt(minLocation) + baseDistance * position) + 'px';
    }

    function getPosition(location) {
        return (parseInt(location) - parseInt(minLocation)) / baseDistance;
    }

    function randomize(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }
</script>